var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},i={},s=e.parcelRequire7b01;null==s&&((s=function(e){if(e in t)return t[e].exports;if(e in i){var s=i[e];delete i[e];var l={id:e,exports:{}};return t[e]=l,s.call(l.exports,l,l.exports),l.exports}var a=Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){i[e]=t},e.parcelRequire7b01=s),(0,s.register)("efyfk",function(e,t){e.exports=class{constructor(e){this.direction={up:"up",down:"down",left:"left",right:"right"},this.gameStatus={idle:"idle",playing:"playing",win:"win",lose:"lose"},this.initialField=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.score=0,this.cellMax=0,this.fieldSize=4,this.isAvailableMovement=!0,this.status=this.gameStatus.idle,this.isCustomInitial=!!e,this.defaultState=e||this.initialField}moveLeft(){this.status=this.gameStatus.playing,this.sumGameFieldByRow(this.direction.left)}moveRight(){this.status=this.gameStatus.playing,this.sumGameFieldByRow(this.direction.right)}moveUp(){this.status=this.gameStatus.playing,this.sumGameFieldByColumn(this.direction.up)}moveDown(){this.status=this.gameStatus.playing,this.sumGameFieldByColumn(this.direction.down)}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.state=this.isCustomInitial&&this.initialCustomState.length===this.fieldSize?this.initialCustomState:this.initialField,this.status=this.gameStatus.playing,this.generateRandomCellOnField(2)}restart(){this.isCustomInitial?this.state=this.defaultState:(this.state=this.initialField,this.generateRandomCellOnField(2)),this.score=0,this.status=this.gameStatus.idle}gMaxCell(){return this.cellMax}getMoveAvailability(){return this.isAvailableMovement}getMaxValueCell(e){return Math.max(...e.flat())}getRandomCellValue(){return .9>Math.random()?2:4}getRandomCellIndex(e=this.fieldSize){return{row:Math.floor(Math.random()*e),col:Math.floor(Math.random()*e)}}sumRow(e,t=this.fieldSize,i=!0){let s=!1,l=0;if(i){let i=e.reduceRight((e,t,i)=>{if(!t)return e;let a=e[0];return t!==a||s?[t,...e]:(s=!0,l=2*a,[2*a,...e.slice(1)])},[]);return{row:4===i.length?i:[...Array(t-i.length).fill(0),...i],summCollapsed:l}}let a=e.reduce((e,t,i)=>t?0===i?(e.push(t),e):t!==e[e.length-1]||s?[...e,t]:(s=!0,l=2*e.slice(-1),[...e.slice(0,-1),2*e.slice(-1)]):e,[]);return{row:4===a.length?a:[...a,...Array(t-a.length).fill(0)],summCollapsed:l}}transposeField(e){return e.reduce((e,t)=>(t.forEach((t,i)=>{e[i]=[...e[i]||[],t]}),e),[])}compareGameField(e,t){return JSON.stringify(e)===JSON.stringify(t)}getAvailabilityMovement(e){let t=0;return!!e.flat().includes(0)||(e.forEach(e=>{let{summCollapsed:i}=this.sumRow(e,this.fieldSize,this.direction.left),{summCollapsed:s}=this.sumRow(e,this.fieldSize,this.direction.right);t+=i+s}),this.transposeField(e).forEach(e=>{let{summCollapsed:i}=this.sumRow(e,this.fieldSize,this.direction.up),{summCollapsed:s}=this.sumRow(e,this.fieldSize,this.direction.down);t+=i+s}),t>0)}sumGameFieldByRow(e){let t=this.state,i=this.fieldSize,s=this.score||0,l=t.map(t=>{let{row:l,summCollapsed:a}=this.sumRow(t,i,e===this.direction.right);return s+=a,l});this.compareGameField(t,l)||(this.score=s,this.state=l,this.cellMax=this.getMaxValueCell(l),this.generateRandomCellOnField())}sumGameFieldByColumn(e){let t=this.state,i=this.fieldSize,s=this.score||0,l=this.transposeField(t).map(t=>{let{row:l,summCollapsed:a}=this.sumRow(t,i,e===this.direction.down);return s+=a,l});this.compareGameField(t,l)||(this.score=s,this.state=this.transposeField(l),this.cellMax=this.getMaxValueCell(l),this.generateRandomCellOnField())}generateRandomCellOnField(e=1){let t=JSON.parse(JSON.stringify(this.state));for(let i=0;i<e;i++){let e=this.getRandomCellIndex(),i=this.getRandomCellValue();for(;t[e.row][e.col];)e=this.getRandomCellIndex();t[e.row][e.col]=i}this.state=t,this.isAvailableMovement=this.getAvailabilityMovement(t)}}}),document.addEventListener("DOMContentLoaded",()=>{let e=new(s("efyfk")),t=document.querySelector(".button"),i=()=>e.getStatus(),l=()=>e.getState(),a=()=>e.getScore(),r=()=>e.gMaxCell(),n=()=>e.getMoveAvailability(),o=document.querySelector(".message-start"),d=document.querySelector(".message-win"),h=document.querySelector(".message-lose"),u=document.querySelector(".game-score"),m=document.querySelectorAll(".field-row"),c=[];m.forEach(e=>{c.push(e.querySelectorAll(".field-cell"))});let g=()=>{e.restart(),w(),d.classList.add("hidden"),h.classList.add("hidden")},f=()=>{t.classList.remove("start"),t.classList.add("restart"),t.textContent="Restart"},p=()=>{t.classList.remove("restart"),t.classList.add("start"),t.textContent="Start"},w=()=>{let e=l(),t=r(),i=n();u.textContent=a();for(let t=0;t<c.length;t++){let i=c[t];for(let s=0;s<i.length;s++){let l=e[t][s],a=i[s];a.textContent="",a.className="field-cell",l&&(a.textContent=l,a.className=`field-cell field-cell--${l}`)}}2048===t&&(document.removeEventListener("keydown",y),d.classList.remove("hidden")),i||(document.removeEventListener("keydown",y),h.classList.remove("hidden"))},y=t=>{switch("playing"===i()&&f(),t.key){case"ArrowLeft":e.moveLeft(),w();break;case"ArrowRight":e.moveRight(),w();break;case"ArrowUp":e.moveUp(),w();break;case"ArrowDown":e.moveDown(),w()}};t.addEventListener("click",t=>{t.preventDefault();let s=t.target.classList.contains("restart"),l=t.target.classList.contains("start");"playing"===i()&&s&&(g(),p(),document.addEventListener("keydown",y)),"playing"===i()&&l&&(g(),w()),"idle"===i()&&l&&(e.start(),t.currentTarget.blur(),o.classList.add("hidden"),w(),document.addEventListener("keydown",y))})});
//# sourceMappingURL=index.b3e4f9bc.js.map
